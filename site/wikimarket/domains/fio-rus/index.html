<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="robots" content="noindex, nofollow">
  <title>Именной домен .РУС для {{user_name}} | UpgradeFor</title>
  <link
    rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,200,0,0"
  >
  <link rel="stylesheet" href="/assets/layout.css">

  <style>
    .hero-notice {
      font-size: 0.85rem;
      color: var(--muted);
      margin: 0 0 var(--space-1);
    }
    .hero-domain {
      display: inline-flex;
      align-items: center;
      padding: 12px 16px;
      border: 1px solid var(--line);
      border-radius: var(--r-card);
      background: var(--surface);
      font-size: clamp(22px, 4vw, 40px);
      font-weight: 700;
      margin: var(--space-2) 0 var(--space-2);
      box-shadow: var(--shadow);
    }
    .hero-fact {
      font-size: 0.95rem;
      color: var(--text);
      margin: 0 0 var(--space-2);
    }
    .hero-cta-meta {
      font-size: 0.85rem;
      color: var(--muted);
      margin: 8px 0 0;
    }
    .hero-secondary {
      font-size: 0.95rem;
      color: var(--brand-blue);
      text-decoration: none;
    }
    .hero-secondary:hover {
      text-decoration: underline;
    }
    .info-block {
      background: var(--surface);
      border: 1px solid var(--line);
      border-radius: var(--r-card);
      padding: var(--space-3);
    }
    .info-block h3 {
      margin: var(--space-2) 0 var(--space-1);
      font-size: 1rem;
    }
    .info-block ol {
      margin: 0;
      padding-left: 20px;
    }
    .info-block li {
      margin-bottom: 6px;
    }
    .info-block__security {
      font-size: 0.85rem;
      color: var(--muted);
      margin-top: var(--space-2);
      margin-bottom: 0;
    }
    .mobile-cta {
      display: none;
    }
    @media (max-width: 768px) {
      body {
        padding-bottom: 76px;
      }
      .mobile-cta {
        display: flex;
        position: fixed;
        left: 0;
        right: 0;
        bottom: 0;
        z-index: 20;
        background: var(--surface);
        border-top: 1px solid var(--line);
        padding: 12px 16px;
        gap: 12px;
        align-items: center;
        justify-content: space-between;
        box-shadow: 0 -8px 24px rgba(15, 23, 42, 0.08);
      }
      .mobile-cta__domain {
        font-weight: 600;
        font-size: 0.95rem;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        max-width: 55vw;
      }
    }
    .deadline-badge {
      display: flex;
      flex-direction: column;
      gap: 8px;
      padding: 14px 16px;
      border: 1px solid var(--line);
      border-radius: var(--r-card);
      background: var(--surface);
    }
    .deadline-text {
      display: flex;
      flex-direction: column;
    }
    .deadline-label {
      font-size: 1rem;
      color: var(--text);
      font-weight: 600;
      margin: 0;
    }
    .deadline-value {
      font-size: 1rem;
      font-weight: 600;
      margin: 0;
    }
    .deadline-secondary {
      font-size: 0.85rem;
      color: var(--muted);
      margin: 0;
    }
    .deadline-note {
      font-size: 0.85rem;
      color: var(--muted);
      margin: 0;
    }
    .deadline-urgent .deadline-value {
      font-weight: 600;
    }
    .deadline-badge.expired .deadline-value {
      font-weight: 600;
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      column-gap: 24px;
      row-gap: 20px;
    }
    @media (max-width: 768px) {
      .form-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>

<body class="is-home">
  <a class="skip" href="#main">К содержанию</a>

  <header></header>
  <aside class="sidebar" aria-hidden="true"></aside>

  <main id="main" class="app-content">
    <section class="wrap hero" aria-labelledby="hero-title">
      <div>
        <h1 id="hero-title"><span data-user-name>{{user_name}}</span></h1>
        <h2 class="section-title" style="margin-top:var(--space-1)">Для вас найден свободный персональный домен на кириллице</h2>
        <p class="hero-notice">Уведомление о доступности домена (не реклама)</p>
        <div class="hero-domain">
          <span data-user-domain>{{user_domain}}</span>
        </div>
        <p class="hero-fact">Совпадение домена с вашим ФИО — 100%</p>

        <div class="cta" style="display:flex;gap:12px;margin-top:var(--space-3);flex-wrap:wrap;align-items:center">
          <a class="btn" href="#form" data-cta-link="primary" data-event="cta_click" data-location="hero">Оформить домен сейчас</a>
          <a class="hero-secondary" href="#why-unique">Как это работает? →</a>
        </div>

        <p class="hero-cta-meta">Оплата займёт 2 минуты</p>
      </div>

      <div class="hero-art" aria-label="Визуальный блок домена">
        <div style="padding:var(--space-4);text-align:center">
          <div class="tag" style="margin-bottom:var(--space-2)">Домен .РУС</div>
          <div style="font-size:clamp(24px,4vw,42px);font-weight:700">
            <span data-user-domain>{{user_domain}}</span>
          </div>
          <p class="lead" style="margin-top:var(--space-2)">Запоминающийся адрес для вашего проекта.</p>
        </div>
      </div>
    </section>

    <section class="wrap" id="why-unique" aria-labelledby="why-unique-title">
      <div class="card" style="background:var(--surface);border:1px solid var(--line)">
        <h2 class="section-title" id="why-unique-title" style="margin-top:0">Почему этот домен уникален</h2>
        <p class="lead" style="margin-top:var(--space-1)">Это единственный вариант на кириллице, который 1:1 совпадает с вашим ФИО.</p>
        <ul style="margin-top:var(--space-2)">
          <li>Кириллица ≠ латиница</li>
          <li>ФИО пишется только так — без аналогов</li>
          <li>Второго такого домена быть не может</li>
          <li>Если домен станет недоступен — альтернатив не будет</li>
        </ul>
        <p style="font-size:0.85rem;color:var(--muted);margin-top:var(--space-2);margin-bottom:0">
          Речь о совпадении строки домена с ФИО, а не о праве собственности на имя
        </p>
      </div>
    </section>

    <section class="wrap" aria-label="Статус резерва домена">
      <div class="card" style="margin-top:var(--space-1)" aria-label="Статус резерва домена">
        <div class="deadline-badge" id="reserve-status">
          <div class="deadline-text">
            <h3 class="deadline-label">Статус резерва домена</h3>
            <p class="deadline-value" id="domain-status">Резерв активен до: <span id="reserve-until">сегодня 23:59</span> (МСК)</p>
            <p class="deadline-note" id="reserve-note">После этого домен может быть зарегистрирован другим лицом.</p>
            <p class="deadline-note" id="reserve-warning">Если домен будет занят — этот вариант станет для вас недоступен.</p>
            <p class="deadline-secondary" id="reserve-late">Нельзя “вернуться позже”, “выкупить дороже” или “заказать через поддержку”, если домен займут.</p>
            <p class="deadline-secondary">Осталось времени: <span id="deadlineValue">24:00:00</span></p>
          </div>
        </div>
      </div>
    </section>

    <section class="wrap" aria-label="Легитимность и оформление">
      <div class="info-block">
        <p>Такие уведомления получают владельцы имён, фамилий и брендов, когда появляется возможность закрепить имя в цифровом пространстве. Это стандартная процедура регистрации доменных имён.</p>
        <h3>Как проходит оформление</h3>
        <ol>
          <li>Вы подтверждаете оформление и переходите к оплате</li>
          <li>Оплата проходит через защищённый платёжный сервис</li>
          <li>После оплаты домен регистрируется на вас, вы получаете подтверждение</li>
        </ol>
        <p class="info-block__security">Оплата защищена. Передача данных происходит по HTTPS.</p>
      </div>
    </section>

    <div class="mobile-cta" aria-label="Оформление домена">
      <div class="mobile-cta__domain">
        <span data-user-domain>{{user_domain}}</span>
      </div>
      <a class="btn" href="#form" data-cta-link="mobile" data-event="cta_click" data-location="sticky">Оформить</a>
    </div>

    <section class="wrap" id="reputation" aria-labelledby="reputation-title">
      <div class="grid" style="align-items:start">
        <div class="card">
          <h2 class="section-title" id="reputation-title">Ваше имя может оформить кто угодно</h2>
          <p class="lead">Доменные зоны — открытая система. Если домен свободен, его может зарегистрировать любой человек.</p>

          <p style="margin-top:var(--space-2)">
            <strong>Поэтому личный домен лучше, чтобы принадлежал именно вам — а не кому-то другому.</strong>
          </p>

          <ul style="margin-top:var(--space-2)">
            <li>Ваш ФИО-домен может оформить не только вы, но и любой другой человек</li>
            <li>Это может быть знакомый, коллега, конкурент или случайный пользователь</li>
            <li>Домен не является документом и сам по себе не подтверждает личность владельца</li>
          </ul>

          <h3 style="margin-top:var(--space-3)">Что будет, если домен оформит другой человек</h3>
          <ul>
            <li>Он определяет, что будет размещено на странице</li>
            <li>Именно его сайт может показываться выше при поиске вашего имени</li>
            <li>Вернуть домен позже может быть сложно, долго или дорого</li>
          </ul>

          <div class="card" style="margin-top:var(--space-3);background:var(--surface);border:1px solid var(--line)">
            <p style="margin:0">
              <strong>Оценка по модели ИИ (без гарантий):</strong>
              для уникального ФИО-домена при корректном заполнении страницы шанс занять позиции в топ-3 по запросу “Фамилия Имя Отчество” часто высокий, ориентировочно 60–85% в течение 2–8 недель. Фактический результат зависит от конкуренции, региона, языка, качества контента и возраста домена.
            </p>
          </div>

          <p class="lead" style="margin-top:var(--space-2)">
            Совет: проверьте ФИО близких — иногда свободные домены можно занять заранее (семья, родители, дети, публичные лица).
          </p>

          <p style="font-size:0.85rem;color:var(--muted);margin-top:var(--space-2)">
            Домен не подтверждает личность владельца и может быть зарегистрирован любым пользователем в рамках правил доменной зоны. Мы рекомендуем оформлять персональные домены владельцам соответствующих имён для контроля репутации и публичной информации.
          </p>
        </div>

        <div class="card">
          <h3 style="margin-top:0">Заберите домен первым</h3>
          <p class="lead">Пока домен свободен и зарезервирован по вашей ссылке, вы можете оформить его на себя.</p>
          <a class="btn" href="#form" data-cta-link="reputation" style="margin-top:var(--space-2)">Оформить домен на себя</a>
          <p style="font-size:0.85rem;color:var(--muted);margin-top:var(--space-2);margin-bottom:0">
            Чем раньше вы оформите домен, тем меньше риск, что его зарегистрирует кто-то другой.
          </p>
        </div>
      </div>
    </section>

    <section class="wrap" aria-labelledby="seo-advantage-title">
      <h2 class="section-title" id="seo-advantage-title">ФИО-домен — фора к первому месту в поиске</h2>
      <p class="lead">Когда человека ищут по фамилии, имени и отчеству, поисковые системы стремятся показать наиболее точный и релевантный результат. Персональный домен с вашим ФИО даёт сильное преимущество в этой выдаче.</p>

      <div class="card" style="margin-top:var(--space-3)">
        <p>По оценке ИИ-анализа низкочастотных запросов и поведения поисковых систем (Google и Яндекс):</p>
        <ul>
          <li>запросы вида «Фамилия Имя Отчество» относятся к ультранизкой частотности</li>
          <li>конкуренция по таким запросам, как правило, в 10–50 раз ниже, чем по общим ключам</li>
          <li>персональный домен, точно совпадающий с ФИО, значительно усиливает релевантность страницы</li>
        </ul>
        <p class="lead">Это создаёт фору ещё до SEO-продвижения.</p>
      </div>

      <div class="card" style="margin-top:var(--space-3)">
        <h3>Оценка вероятности попадания в ТОП-1 поисковой выдачи*</h3>
        <p class="lead">(при корректно заполненной странице и отсутствии сильных конкурентов)</p>
        <ul>
          <li>Яндекс: ~ 65–85%</li>
          <li>Google: ~ 55–75%</li>
        </ul>
        <p><strong>Факторы, повышающие вероятность:</strong></p>
        <ul>
          <li>уникальный домен, совпадающий с ФИО</li>
          <li>персональный контент (биография, регалии, деятельность)</li>
          <li>отсутствие прямых однофамильцев с сильными сайтами</li>
        </ul>
        <p class="lead" style="font-size:0.85rem;color:var(--muted);margin-top:var(--space-2)">
          *Оценка основана на модели ИИ-анализа низкочастотных персональных запросов и практике SEO. Не является гарантией.
        </p>
      </div>

      <div class="cards-3" style="margin-top:var(--space-3)">
        <article class="card">
          <h3>Контроль репутации</h3>
          <p>Вы сами определяете, какая информация о вас показывается первой: профессия, опыт, достижения, контакты, ссылки.</p>
        </article>
        <article class="card">
          <h3>Защита от искажений</h3>
          <p>Вместо случайных справочников, форумов или устаревших данных — официальная страница под вашим именем.</p>
        </article>
        <article class="card">
          <h3>Долгосрочный эффект</h3>
          <p>ФИО-домен работает годами: один раз оформляется — постоянно усиливает вашу позицию в поиске.</p>
        </article>
      </div>

      <div style="margin-top:var(--space-3)">
        <p class="lead" style="font-size:0.85rem;color:var(--muted)">
          Результаты зависят от контента, конкуренции, региона и алгоритмов поисковых систем. UpgradeFor не гарантирует конкретную позицию, но предоставляет инструмент, значительно повышающий вероятность выхода в верхние позиции по персональному запросу.
        </p>
      </div>

      <div class="cta" style="display:flex;gap:12px;margin-top:var(--space-3);flex-wrap:wrap">
        <a class="btn" href="#form">Оформить домен и закрепить имя</a>
      </div>
      <p class="lead" style="font-size:0.85rem;color:var(--muted);margin-top:8px">Домен резервируется на 24 часа</p>
    </section>

    <section class="wrap" id="benefits" aria-labelledby="benefits-title">
      <h2 class="section-title" id="benefits-title">Преимущества домена .РУС</h2>
      <div class="cards-6">
        <article class="card">
          <span class="material-symbols-outlined" aria-hidden="true">public</span>
          <h3>Локальная идентичность</h3>
          <p>Показывает связь с русскоязычной аудиторией.</p>
        </article>
        <article class="card">
          <span class="material-symbols-outlined" aria-hidden="true">verified</span>
          <h3>Доверие пользователей</h3>
          <p>Домен с понятным окончанием вызывает уверенность.</p>
        </article>
        <article class="card">
          <span class="material-symbols-outlined" aria-hidden="true">search</span>
          <h3>Хорошая заметность</h3>
          <p>Простой домен легче запомнить и найти.</p>
        </article>
        <article class="card">
          <span class="material-symbols-outlined" aria-hidden="true">security</span>
          <h3>Защита бренда</h3>
          <p>Закрепляет ваш проект в русскоязычной зоне.</p>
        </article>
        <article class="card">
          <span class="material-symbols-outlined" aria-hidden="true">support</span>
          <h3>Поддержка и сопровождение</h3>
          <p>Помогаем с регистрацией и подключением.</p>
        </article>
      </div>
    </section>

    <section class="wrap" id="visual" aria-labelledby="visual-title">
      <h2 class="section-title" id="visual-title">Как выглядит ваш домен</h2>
      <div class="grid">
        <div class="card">
          <h3><span data-user-domain>{{user_domain}}</span></h3>
          <p>Домен будет отображаться на всех страницах, в письмах и в ссылках на ваш сервис.</p>
        </div>
        <div class="card" aria-hidden="true" style="display:flex;align-items:center;justify-content:center">
          <div style="font-size:clamp(22px,4vw,40px);font-weight:700"><span data-user-domain>{{user_domain}}</span></div>
        </div>
      </div>
    </section>

    <section class="wrap" id="includes" aria-labelledby="includes-title">
      <h2 class="section-title" id="includes-title">Что входит в услугу</h2>
      <div class="card">
        <ul>
          <li>Регистрация домена</li>
          <li>Настройка и подключение</li>
          <li>Поддержка</li>
          <li>Привязка к профилю UpgradeFor</li>
          <li>Без скрытых платежей</li>
          <li>Поддержка реального специалиста</li>
          <li>Работаем официально</li>
        </ul>
      </div>
    </section>

    <section class="wrap" id="form" aria-labelledby="form-title">
      <h2 class="section-title" id="form-title">Заполните форму</h2>
      <p class="lead">Мы используем данные только для регистрации домена. Никакого спама. Вы получите подтверждение по email.</p>
      <p class="lead" id="form-status" hidden>Срок действия ссылки истёк. Отправка заявки недоступна.</p>

      <form class="card" aria-label="Форма получения домена">
        <div class="form-grid" style="margin-bottom:var(--space-3)">
          <div>
            <label for="first-name"><strong>Имя</strong></label>
            <input id="first-name" name="first-name" type="text" placeholder="Имя" style="width:100%;padding:12px;border-radius:12px;border:1px solid var(--line);margin-top:8px">
            <p class="lead" data-error-for="first-name" hidden>Пожалуйста, заполните поле</p>
          </div>
          <div>
            <label for="last-name"><strong>Фамилия</strong></label>
            <input id="last-name" name="last-name" type="text" placeholder="Фамилия" style="width:100%;padding:12px;border-radius:12px;border:1px solid var(--line);margin-top:8px">
            <p class="lead" data-error-for="last-name" hidden>Пожалуйста, заполните поле</p>
          </div>
        </div>

        <div class="form-grid" style="margin-bottom:var(--space-3)">
          <div>
            <label for="middle-name"><strong>Отчество</strong></label>
            <input id="middle-name" name="middle-name" type="text" placeholder="Отчество" style="width:100%;padding:12px;border-radius:12px;border:1px solid var(--line);margin-top:8px">
          </div>
          <div>
            <label for="email"><strong>Email</strong></label>
            <input id="email" name="email" type="email" placeholder="Email" style="width:100%;padding:12px;border-radius:12px;border:1px solid var(--line);margin-top:8px">
            <p class="lead" data-error-for="email" hidden>Пожалуйста, заполните поле</p>
          </div>
        </div>

        <button class="btn" type="submit" data-cta-button="submit" data-event="form_submit" data-domain="{{user_domain}}">Получить мой домен</button>

        <div class="card" id="form-success" hidden style="margin-top:var(--space-3)">
          <p style="margin:0"><strong>Заявка принята ✅</strong></p>
          <p style="margin:8px 0 0">Мы свяжемся с вами в ближайшее время.</p>
        </div>
      </form>
    </section>

    <section class="wrap" id="faq" aria-labelledby="faq-title">
      <h2 class="section-title" id="faq-title">FAQ</h2>
      <div style="display:grid;gap:var(--gap)">
        <details class="card">
          <summary>Как быстро происходит регистрация домена?</summary>
          <p>После подтверждения заявки домен регистрируется в стандартные сроки регистратора.</p>
        </details>
        <details class="card">
          <summary>Могу ли я сменить домен позже?</summary>
          <p>Да, в будущем можно оформить другой домен и перенастроить привязку.</p>
        </details>
        <details class="card">
          <summary>Нужно ли что-то настраивать самостоятельно?</summary>
          <p>Мы берём на себя настройку и подключение к вашему профилю.</p>
        </details>
        <details class="card">
          <summary>Что будет, если не успеть за 24 часа?</summary>
          <p>Предложение может быть пересмотрено, и домен станет доступен другим пользователям.</p>
        </details>
        <details class="card">
          <summary>Где будет использоваться домен?</summary>
          <p>В ссылках, письмах, профиле и публичных страницах вашего проекта.</p>
        </details>
        <details class="card">
          <summary>Можно ли получить помощь после регистрации?</summary>
          <p>Да, поддержка включена в услугу и отвечает на вопросы после запуска.</p>
        </details>
      </div>
    </section>

    <section class="wrap" id="final-cta" aria-labelledby="final-cta-title">
      <div class="card">
        <h2 class="section-title" id="final-cta-title">Ограничение 24 часа</h2>
        <p class="lead" id="expiry-text">Мы резервируем домен <span data-user-domain>{{user_domain}}</span> на 24 часа, чтобы вы могли принять решение без спешки. После окончания срока предложение может быть отозвано.</p>
        <a class="btn" href="#form" style="margin-top:var(--space-3)" data-cta-link="secondary">Оформить домен</a>
        <a class="btn btn--ghost" href="/signup" data-expired-link hidden data-event="request_new_link" style="margin-top:var(--space-2)">Запросить новую ссылку</a>
      </div>
    </section>
  </main>

  <script>
    (function() {
      var params = new URLSearchParams(window.location.search);
      var token = params.get('t');
      var currentToken = token || '';
      var nameParam = params.get('name');
      var domainParam = params.get('domain');
      var expiresParam = params.get('expires');

      var userName = nameParam || 'друг';
      var userDomain = domainParam || 'ваш-домен.рус';

      document.querySelectorAll('[data-user-name]').forEach(function(node) {
        node.textContent = userName;
      });
      document.querySelectorAll('[data-user-domain]').forEach(function(node) {
        node.textContent = userDomain;
      });

      var countdownEl = document.getElementById('deadlineValue');
      var countdownBadge = document.getElementById('reserve-status');

      var expiryText = document.getElementById('expiry-text');
      var expiredLink = document.querySelector('[data-expired-link]');
      var formStatus = document.getElementById('form-status');
      var domainStatus = document.getElementById('domain-status');
      var reserveUntil = document.getElementById('reserve-until');
      var reserveNote = document.getElementById('reserve-note');
      var reserveWarning = document.getElementById('reserve-warning');
      var reserveLate = document.getElementById('reserve-late');
      var ctaLinks = document.querySelectorAll('[data-cta-link]');
      var ctaButton = document.querySelector('[data-cta-button]');
      var form = document.querySelector('form');
      var formSuccess = document.getElementById('form-success');
      var formFields = form ? form.querySelectorAll('input') : [];

      var storageKey = 'fio-rus-expires-at';
      var sentKey = 'domain_request_sent:' + (currentToken || 'no-token') + ':' + userDomain;

      var expiresAt;

      if (ctaButton) {
        ctaButton.setAttribute('data-domain', userDomain);
      }

      var isExpired = false;
      var isSent = localStorage.getItem(sentKey) === 'true';
      var hasExpiresParam = Boolean(expiresParam);

      if (expiresParam) {
        var parsedDate = new Date(expiresParam);
        if (!isNaN(parsedDate)) {
          expiresAt = parsedDate;
          localStorage.setItem(storageKey, parsedDate.toISOString());
        }
      }

      if (!expiresAt) {
        var storedExpires = localStorage.getItem(storageKey);
        if (storedExpires) {
          var storedDate = new Date(storedExpires);
          if (!isNaN(storedDate)) {
            expiresAt = storedDate;
          }
        }
      }

      if (!expiresAt) {
        var now = new Date();
        expiresAt = new Date(now.getTime() + 24 * 60 * 60 * 1000);
        localStorage.setItem(storageKey, expiresAt.toISOString());
      }

      function formatReserveUntil(date) {
        try {
          return date.toLocaleString('ru-RU', {
            timeZone: 'Europe/Moscow',
            day: 'numeric',
            month: 'long',
            hour: '2-digit',
            minute: '2-digit'
          });
        } catch (error) {
          return '';
        }
      }

      if (reserveUntil && expiresAt && hasExpiresParam) {
        var formattedReserve = formatReserveUntil(expiresAt);
        if (formattedReserve) {
          reserveUntil.textContent = formattedReserve;
        }
      }

      function disableForm() {
        if (formStatus) {
          formStatus.hidden = false;
        }
        formFields.forEach(function(field) {
          field.setAttribute('disabled', 'disabled');
        });
        if (ctaButton) {
          ctaButton.setAttribute('disabled', 'disabled');
        }
      }

      function disableCtas() {
        ctaLinks.forEach(function(link) {
          link.setAttribute('aria-disabled', 'true');
          link.setAttribute('tabindex', '-1');
        });
        if (ctaButton) {
          ctaButton.setAttribute('disabled', 'disabled');
        }
      }

      function setExpiredState() {
        isExpired = true;

        if (countdownEl) {
          countdownEl.textContent = '00:00:00';
        }
        if (countdownBadge) {
          countdownBadge.classList.remove('deadline-urgent');
          countdownBadge.classList.add('expired');
        }

        if (expiryText) {
          expiryText.textContent = 'Срок действия ссылки истёк. Запросите новую ссылку, чтобы продолжить.';
        }
        if (domainStatus) {
          domainStatus.textContent = 'Резерв завершён.';
        }
        if (reserveUntil) {
          reserveUntil.textContent = '—';
        }
        if (reserveNote) {
          reserveNote.textContent = 'Домен может быть уже недоступен. Проверьте статус.';
        }
        if (reserveWarning) {
          reserveWarning.textContent = 'Домен может быть уже недоступен. Проверьте статус.';
        }
        if (reserveLate) {
          reserveLate.textContent = 'Нельзя “вернуться позже” или оформить через поддержку, если домен займут.';
        }
        if (expiredLink) {
          expiredLink.hidden = false;
        }

        disableCtas();
        disableForm();
      }

      function setDomainMissingState() {
        if (domainStatus) {
          domainStatus.textContent = 'Домен не определён — требуется персональная ссылка.';
        }
        if (reserveUntil) {
          reserveUntil.textContent = '—';
        }
        if (reserveNote) {
          reserveNote.textContent = 'Используйте персональную ссылку, чтобы подтвердить резерв.';
        }
        if (reserveWarning) {
          reserveWarning.textContent = 'После подтверждения домен будет доступен для оформления.';
        }
        if (reserveLate) {
          reserveLate.textContent = 'Используйте персональную ссылку, чтобы увидеть условия резерва.';
        }
        disableCtas();
      }

      function setActiveState() {
        if (reserveNote) {
          reserveNote.textContent = 'После этого домен может быть зарегистрирован другим лицом.';
        }
        if (reserveWarning) {
          reserveWarning.textContent = 'Если домен займут — вернуться к этому варианту уже нельзя.';
        }
        if (reserveLate) {
          reserveLate.textContent = 'Нельзя “вернуться позже”, “выкупить дороже” или “заказать через поддержку”, если домен займут.';
        }
      }

      function setSentState() {
        if (formStatus) {
          formStatus.textContent = 'Заявка уже отправлена.';
          formStatus.hidden = false;
        }
        disableCtas();
        disableForm();
      }

      function formatTime(ms) {
        var totalSeconds = Math.max(0, Math.floor(ms / 1000));
        var hours = Math.floor(totalSeconds / 3600);
        var minutes = Math.floor((totalSeconds % 3600) / 60);
        var seconds = totalSeconds % 60;
        return String(hours).padStart(2, '0') + ':' + String(minutes).padStart(2, '0') + ':' + String(seconds).padStart(2, '0');
      }

      function tick() {
        if (isSent) return;

        var now = new Date();
        var remaining = expiresAt - now;

        if (remaining <= 0) {
          setExpiredState();
          return;
        }

        if (countdownEl) {
          countdownEl.textContent = formatTime(remaining);
        }

        if (countdownBadge) {
          countdownBadge.classList.remove('expired');
          if (remaining <= 60 * 60 * 1000) {
            countdownBadge.classList.add('deadline-urgent');
          } else {
            countdownBadge.classList.remove('deadline-urgent');
          }
        }
      }

      tick();
      var interval = setInterval(function() {
        if (isSent) {
          clearInterval(interval);
          return;
        }
        if (new Date() > expiresAt) {
          clearInterval(interval);
          setExpiredState();
          return;
        }
        tick();
      }, 1000);

      if (isSent) {
        setSentState();
      } else if (userDomain === 'ваш-домен.рус') {
        setDomainMissingState();
      } else {
        setActiveState();
      }

      ctaLinks.forEach(function(link) {
        link.addEventListener('click', function(event) {
          if (link.getAttribute('aria-disabled') === 'true') {
            event.preventDefault();
            return;
          }
          var firstNameField = document.getElementById('first-name');
          if (firstNameField) {
            setTimeout(function() { firstNameField.focus(); }, 0);
          }
        });
      });

      function setFieldError(field, message) {
        var errorEl = document.querySelector('[data-error-for="' + field.id + '"]');
        if (errorEl) {
          errorEl.textContent = message;
          errorEl.hidden = false;
        }
        field.setAttribute('aria-invalid', 'true');
        field.style.borderColor = '#ef4444';
      }

      function clearFieldError(field) {
        var errorEl = document.querySelector('[data-error-for="' + field.id + '"]');
        if (errorEl) {
          errorEl.hidden = true;
        }
        field.removeAttribute('aria-invalid');
        field.style.borderColor = 'var(--line)';
      }

      function validateEmail(value) {
        return value.indexOf('@') > 0 && value.indexOf('.') > 0;
      }

      if (form) {
        form.addEventListener('submit', function(event) {
          event.preventDefault();

          if (isExpired) {
            disableForm();
            return;
          }

          var firstName = document.getElementById('first-name');
          var lastName = document.getElementById('last-name');
          var email = document.getElementById('email');
          var middleName = document.getElementById('middle-name');

          var isValid = true;

          [firstName, lastName, email].forEach(function(field) {
            if (!field) return;
            if (!field.value.trim()) {
              setFieldError(field, 'Пожалуйста, заполните поле');
              isValid = false;
            } else {
              clearFieldError(field);
            }
          });

          if (email && email.value.trim() && !validateEmail(email.value.trim())) {
            setFieldError(email, 'Пожалуйста, введите корректный email');
            isValid = false;
          }

          if (!isValid) return;

          var payload = {
            name: firstName ? firstName.value.trim() : '',
            lastName: lastName ? lastName.value.trim() : '',
            middleName: middleName ? middleName.value.trim() : '',
            email: email ? email.value.trim() : '',
            domain: userDomain,
            token: currentToken,
            expiresAt: expiresAt ? expiresAt.toISOString() : '',
            source: 'domain-rus-landing'
          };

          if (ctaButton) {
            ctaButton.setAttribute('disabled', 'disabled');
          }

          fetch('/api/domain-request', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
          })
            .then(function(response) {
              if (response.status === 410) {
                if (formStatus) {
                  formStatus.textContent = 'Срок действия ссылки истёк. Запросите новую ссылку.';
                  formStatus.hidden = false;
                }
                setExpiredState();
                return null;
              }
              if (response.status === 409) {
                if (formStatus) {
                  formStatus.textContent = 'Заявка уже отправлена.';
                  formStatus.hidden = false;
                }
                return null;
              }
              if (!response.ok) {
                if (formStatus) {
                  formStatus.textContent = 'Не удалось отправить заявку. Попробуйте позже.';
                  formStatus.hidden = false;
                }
                return null;
              }
              return response.json();
            })
            .then(function(data) {
              if (!data || data.status !== 'ok') {
                if (ctaButton) ctaButton.removeAttribute('disabled');
                return;
              }
              if (ctaButton) ctaButton.hidden = true;
              if (formSuccess) formSuccess.hidden = false;
              localStorage.setItem(sentKey, 'true');
            })
            .catch(function() {
              if (formStatus) {
                formStatus.textContent = 'Не удалось отправить заявку. Попробуйте позже.';
                formStatus.hidden = false;
              }
              if (ctaButton) ctaButton.removeAttribute('disabled');
            });
        });
      }
    })();
  </script>

  <script src="/assets/load-layout.js"></script>
</body>
</html>
